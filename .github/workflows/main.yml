name: lab06

on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10

jobs:
  work0:
      runs-on: windows-latest
      steps:
        - uses: actions/checkout@v2
        - name: Compile-0
          run: |
            cd solver_application
            cmake . -Dmake_bin=ON
            cmake --build . --config Release
            cpack -G WIX Release
        - name: move
          run: mv D:/a/lab06/lab06/solver_application/wixxx.msi art
        - name: Create Release
          id: create_release
          uses: actions/create-release@v1
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            tag_name: ${{ github.ref }}
            release_name: Release ${{ github.ref }}
            draft: false
            prerelease: false 
        - name: Upload release
          id: upload-release-asset
          uses: actions/upload-release-asset@v1
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            upload_url: ${{ steps.create_release.outputs.upload_url }}
            asset_path: art/wixxx.msi
            asset_name: wix
            asset_content_type: application/msi
  work1:
      runs-on: macos-latest
      steps:
        - uses: actions/checkout@v2
        - name: Compile-1
          run: |
            cd solver_application
            cmake . -Dmake_bin=ON
            make
            cpack -G DragNDrop
        - name: move
          run: mv /Users/runner/work/lab06/lab06/solver_application/wixxx.dmg art
  work:
      runs-on: ubuntu-latest 
      steps:
        - uses: actions/checkout@v2
        - name: Download
          run: sudo apt install g++ cmake rpm
        - name: Compile-1
          run: |
            cd solver_application
            cmake . -Dmake_bin=ON
            make
            cpack -G DEB
            cpack -G RPM
        - name: move
          run: |
            mv /home/runner/work/lab06/lab06/solver_application/solvering.rpm art
            mv /home/runner/work/lab06/lab06/solver_application/solvering.deb art
        - name: Compile-2
          run: |
            cd solver_application
            cmake . -Dmake_bin=OFF
            make
            cpack -G ZIP
            cpack -G TGZ
        - name: move1
          run: |
            mv /home/runner/work/lab06/lab06/solver_application/just_code.zip art
            mv /home/runner/work/lab06/lab06/solver_application/just_code.tar.gz art 
